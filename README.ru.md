# Доказательство капиталом (Proof of Capital)

**Доступно на других языках:** [English](README.md) | [Español](README.es.md)

---

Доказательство капиталом (**Proof of Capital**) — это технология умного маркет-мейкинга (смарт-контракт), которая защищает интересы всех держателей. 

Создатели передают всю имеющуюся у них эмиссию своего актива контракту, и монеты высвобождаются только за 
TON или, при включенной поддержке, любой другой жетон, которые остаются на контракте в качестве обеспечения. Контракту можно как продавать монеты, получая обеспечение с верхних уровней, так и возвращать монеты, чтобы высвобождать обеспечение с нижних уровней и тем самым увеличивать минимальную цену за актив.
Контракт поддерживает запуск как с нуля, так и с учётом предыдущей истории актива. Для этого можно задать параметр отступа — эквивалент ранее проданных монет, который позволяет начать работу контракта с нужного уровня цены и остатка обеспечения. Это особенно важно для уже существующих проектов, переходящих на Proof of Capital.

---

## Содержание

- [Доказательство капиталом (Proof of Capital)](#доказательство-капиталом-proof-of-capital)
  - [Содержание](#содержание)
  - [Структура проекта Blueprint](#структура-проекта-blueprint)
  - [Запуск контракта](#запуск-контракта)
    - [Добавить новый контракт](#добавить-новый-контракт)
    - [Сборка](#сборка)
    - [Развертывание или запуск скрипта](#развертывание-или-запуск-скрипта)
  - [Основные положения](#основные-положения)
    - [Переменные, задаваемые при инициализации и деплое контракта](#переменные-задаваемые-при-инициализации-и-деплое-контракта)
    - [Описание переменных](#описание-переменных)
  - [Принцип работы контракта](#принцип-работы-контракта)
    - [Функции контракта](#функции-контракта)
    - [Важные замечания](#важные-замечания)
  - [Обращение к геттер-функциям](#обращение-к-геттер-функциям)
  - [Контактная информация](#контактная-информация)

---

## Структура проекта Blueprint

- `contracts` — исходный код всех смарт-контрактов проекта и их зависимости.
- `wrappers` — обёртки (классы, реализующие `Contract` из ton-core) для контрактов, включая примитивы для [де]сериализации и функции компиляции.
- `tests` — тесты для контрактов.
- `scripts` — скрипты, используемые в проекте, в основном для деплоя.

## Запуск контракта

### Добавить новый контракт

```bash
npx blueprint create ContractName
# или
yarn create ton ContractName
```
При создании выберите `An empty contract (TACT)`.

### Сборка

```bash
npx blueprint build
# или
yarn blueprint build
```

### Развертывание или запуск скрипта

```bash
npx blueprint run
# или
yarn blueprint run
```

---

## Основные положения

### Переменные, задаваемые при инициализации и деплое контракта

При инициализации и деплое контракта в Tact задаются следующие переменные, которые определяют основные настройки контракта и его начальное состояние:

### Описание переменных

| Переменная                           | Тип данных         | Описание                                                                 |
|--------------------------------------|--------------------|--------------------------------------------------------------------------|
| **owner**                            | `Address`          | Адрес владельца контракта.                                               |
| **marketMakerAddress**               | `Address`          | Адрес маркет-мейкера.                                                    |
| **launchJettonMasterAddress**              | `Address`          | Адрес мастер-контракта жетона.                                           |
| **returnWalletAddress**              | `Address`          | Адрес кошелька для возврата средств.                                     |
| **royaltyWalletAddress**             | `Address`          | Адрес кошелька для роялти.                                               |
| **lockEndTime**                      | `Int as uint64`    | Время окончания блокировки (в секундах с момента эпохи UNIX).            |
| **initialPricePerToken**             | `Int as coins`     | Начальная цена за жетон.                                                 |
| **firstLevelJettonQuantity**         | `Int as coins`     | Количество жетонов на первом уровне.                                     |
| **priceIncrementMultiplier**         | `Int as uint16`    | Множитель для увеличения цены за жетон.                                  |
| **levelIncreaseMultiplier**          | `Int as uint16`    | Множитель для увеличения уровня.                                         |
| **trendChangeStep**                  | `Int as uint8`     | Шаг для изменения тренда.                                                |
| **levelDecreaseMultiplierafterTrend**| `Int as uint16`    | Множитель для уменьшения уровня после изменения тренда.                  |
| **profitPercentage**                 | `Int as uint16`    | Процент прибыли.                                                         |
| **offsetJettons**                    | `Int as coins`     | Количество ранее проданных жетонов (исторический отступ).                |
| **controlPeriod**                    | `Int as uint32`    | Длительность "окна разлока" в UNIX-секундах.                             |
| **jettonSupport**                    | `Bool`             | Включает поддержку покупки жетонов за другие жетоны (например, USDT).    |
| **jettonCollateralMasterAddress**       | `Address`          | Адрес мастер-контракта жетона обеспечения (если включено обеспечение).   |
| **royaltyProfitPercentage**          | `Int as uint16`    | Процент от прибыли, отправляемый на royalty-кошелёк.                     |

---

## Принцип работы контракта

Контракт Proof of Capital предназначен для управления выпуском жетонов, обеспеченных капиталом, с прозрачными условиями эмиссии и обратного выкупа.

### Функции контракта

1. **Разворачивание и начальная настройка:**
   - После разворачивания контракта создатель пополняет его жетонами и устанавливает блокировку (**лок**) на **полгода** или **10 минут** (для начального тестирования контракта).
   - Создатель может продлить **лок** на дополнительный период: **полгода** или **10 минут**.

2. **Взаимодействие с контрактом:**
   - **Market Maker**:
     - Во время действия лока и в периоды, когда не активно "окно разлока", обмениваться токенами с контрактом может только маркет-мейкер.
     - Он имеет право покупать и продавать жетоны, выравнивая цену на контракте с ценами в пулах на DEX.
   - **Другие пользователи**:
     - За **два месяца до окончания лока** взаимодействовать с контрактом могут все желающие.
     - До наступления указанного выше пункта, взаимодействовать с конрактом можно в специальные периоды, называемые **"окном разлока""**. 
     - В период "окна разлока" и за два месяца до окончания лока все желающие могут вернуть приобретенные у контракта жетоны обратно в обмен на обеспечение.
   - **Return Wallet**:
     - Специальный кошелёк, с которого производится возврат токенов на контракт с высвобождением обеспечения с нижних уровней.
     - Это альтернатива процедуре сжигания с целью использования заработанных токенов в будущем при росте капитализации.


3. **Завершение лока:**
   - После окончания лока создатель может вывести все монеты и все обеспечение с контракта.
   
### Важные замечания

- **Используйте геттер-функции:**
  - При работе с контрактом обязательно используйте геттер-функции для проверки результатов своих операций **до** их выполнения.
  - Это поможет избежать непредвиденных результатов.

- **Взаимодействие с контрактом:**
  - Никогда не отправляйте монеты (жетоны) напрямую с вашего кошелька на контракт.
    - Если отправить жетоны без вызова соответствующих функций, контракт может не обработать транзакцию, и ваши монеты будут утеряны.
  - Если вы отправите TON напрямую (при условии обеспечения в TON):
    - Контракт может отклонить операцию, если до окончания лока осталось более двух месяцев либо если включен режим обеспечения в другой монете.
    - Контракт может отправить вам монеты (жетоны), если до окончания лока осталось меньше двух месяцев либо если наступило специальное "окно разлока".
    - Обязательно проверьте результаты геттер-функций перед взаимодействием с контрактом. Если у контракта не достаточно жетонов, то он отправит все, что осталось. Если монет не осталось, то TON просто перейдут на баланс контракта.
  - Аналогичные правила действуют для обеспечения в другой монете, однако такое взаимодействие осуществляется не напрямую, а через специальные программные средства.
    
- **Прибыль и комиссии:**
  - Контракт поддерживает **динамическую настройку распределения прибыли** между владельцем (в качестве фонда на разработку и маркетинг) и royalty-кошельком, включая возможность переключения режима вывода прибыли — сразу или по запросу.
  - Кошелёк **Royalty** указан на сайте [proofofcapital.org](https://proofofcapital.org).

---

## Обращение к геттер-функциям

Для получения данных о текущем состоянии контракта и результатов внутренних функций вы можете использовать геттер-функции:

1. Перейдите в **TON Viewer** или аналогичный инструмент.
2. Откройте вкладку **Methods**.
3. В поле **Arbitrary method** введите название геттер-функции.
4. При необходимости добавьте аргументы.
5. Нажмите кнопку **Execute** для выполнения запроса.

**Рекомендуем** всегда обращаться к геттер-функциям перед выполнением операций для проверки ожидаемых результатов.

---

## Контактная информация

По всем вопросам обращайтесь по нашим контактным данным, указанным на сайте [proofofcapital.org](https://proofofcapital.org/new/ru).

В начале февраля мы прошли второй аудит, который был опубликован в педыдущей версии контракта. Пример работающего по второй версии контракта доступен [по ссылке](https://tonviewer.com/EQBGN2w9fUVNfJ0IBKDQ2vVy6S_lDug4q1UYdRhkFA-r_POK).

Теперь мы выпустили третью версию контракта (текущую) с учетов всех пожеланий пользователей и клиентов и также успешно прошли третий аудит, который будет опубликован по текущей версии контракта.

Следите за важными новостями и обновлениями на нашем канале в телеграм: [@ruspoc](https://t.me/ruspoc).